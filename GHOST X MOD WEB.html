<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GHOST X MODS</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6c5ce7;
            --secondary: #a29bfe;
            --dark: #2d3436;
            --light: #f5f6fa;
            --danger: #d63031;
            --success: #00b894;
            --warning: #fdcb6e;
            --info: #0984e3;
            --admin: #e84393;
            --main-font: 'Roboto', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: var(--main-font);
        }

        body {
            background-color: var(--light);
            color: var(--dark);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* --- Custom Notification Styles --- */
        .custom-alert-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .custom-alert-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .custom-alert-box {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 400px;
            text-align: center;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }

        .custom-alert-overlay.active .custom-alert-box {
            transform: translateY(0);
        }

        .custom-alert-box h3 {
            margin-bottom: 15px;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .custom-alert-box .icon {
            font-size: 30px;
        }

        .custom-alert-box.success h3 { color: var(--success); }
        .custom-alert-box.error h3 { color: var(--danger); }
        .custom-alert-box.info h3 { color: var(--info); }
        .custom-alert-box.warning h3 { color: var(--warning); }

        .custom-alert-box p {
            margin-bottom: 20px;
            font-size: 16px;
            line-height: 1.5;
        }

        .custom-alert-box .alert-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        /* --- Login & Register Page --- */
        .login-page {
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .login-logo img {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
        }

        .login-box h2 {
            margin-bottom: 20px;
            color: var(--primary);
        }

        .login-footer {
            margin-top: 15px;
            font-size: 14px;
        }

        .login-footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }

        .container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .logo {
            display: flex;
            align-items: center;
        }

        .logo img {
            width: 50px;
            height: 50px;
            margin-right: 10px;
        }

        .logo h1 {
            font-size: 24px;
            color: var(--primary);
        }

        .user-menu {
            display: flex;
            align-items: center;
        }

        .user-menu img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
            border: 2px solid var(--primary);
        }

        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-warning {
            background-color: var(--warning);
            color: var(--dark);
        }

        .btn-info {
            background-color: var(--info);
            color: white;
        }

        .btn-admin {
            background-color: var(--admin);
            color: white;
        }

        /* Stats Cards */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .stat-card h3 {
            font-size: 14px;
            color: #777;
            margin-bottom: 10px;
        }

        .stat-card h2 {
            font-size: 24px;
            font-weight: 600;
        }

        .vip-badge {
            display: inline-block;
            padding: 3px 8px;
            background-color: var(--warning);
            color: var(--dark);
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .admin-badge {
            display: inline-block;
            padding: 3px 8px;
            background-color: var(--admin);
            color: white;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        /* Services */
        .services {
            margin-bottom: 30px;
        }

        .service-tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .service-tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .service-tab.active {
            border-bottom: 2px solid var(--primary);
            color: var(--primary);
            font-weight: 500;
        }

        .service-content {
            display: none;
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .service-content.active {
            display: block;
        }

        /* Forms */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            text-align: left;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        .btn-block {
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            justify-content: center;
        }

        /* Regions */
        .regions {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .region-btn {
            padding: 8px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .region-btn:hover,
        .region-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Result Display */
        .result-container {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }

        .result-container.success {
            background-color: #e8f5e9;
            border-left: 5px solid var(--success);
            display: block;
        }

        .result-container.error {
            background-color: #ffebee;
            border-left: 5px solid var(--danger);
            display: block;
        }

        .result-container.info {
            background-color: #e3f2fd;
            border-left: 5px solid var(--info);
            display: block;
        }

        .result-container h4 {
            margin-bottom: 10px;
        }

        .result-details {
            margin-top: 15px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }

        .result-details p {
            margin-bottom: 5px;
        }

        /* Spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, .3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* --- Profile Page --- */
        .profile-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .profile-avatar-wrapper {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto 10px;
        }

        #profileAvatarDisplay {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--primary);
        }

        #avatarUploadLabel {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: var(--secondary);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 2px solid white;
        }

        #avatarUpload {
            display: none;
        }

        /* Player Info Display */
        .player-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .info-section {
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px;
            background-color: #fcfcfc;
        }

        .info-section h4 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-section p {
            margin-bottom: 5px;
            font-size: 0.95em;
        }

        .media-display {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
            justify-content: center;
        }

        .media-item {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            width: 100%;
            max-width: 350px;
            text-align: center;
        }

        .media-item h4 {
            padding: 10px;
            color: var(--primary);
            border-bottom: 1px solid #eee;
            margin-bottom: 0;
        }

        .media-item img {
            width: 100%;
            height: auto;
            display: block;
        }

        /* --- Buy Coins Page --- */
        .coin-packages {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .coin-package {
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
        }

        .coin-package:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .coin-package i {
            font-size: 40px;
            color: var(--warning);
            margin-bottom: 15px;
        }

        .coin-package h4 {
            font-size: 20px;
            margin-bottom: 10px;
        }

        .coin-price {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 20px;
        }

        /* Admin Panel */
        .admin-panel {
            display: none;
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .admin-panel.active {
            display: block;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .admin-stat-card {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .admin-stat-card h3 {
            font-size: 14px;
            color: #777;
            margin-bottom: 10px;
        }

        .admin-stat-card h2 {
            font-size: 22px;
            font-weight: 600;
        }

        .user-list {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
            border: 1px solid #eee;
            border-radius: 8px;
        }

        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            background-color: white;
        }

        .user-item:last-child {
            border-bottom: none;
        }

        .user-info {
            display: flex;
            align-items: center;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
            border: 2px solid var(--primary);
        }

        .user-details {
            flex-grow: 1;
        }

        .user-name {
            font-weight: 500;
            margin-bottom: 3px;
        }

        .user-status {
            font-size: 12px;
            color: #666;
        }

        .user-actions {
            display: flex;
            gap: 8px;
        }

        .user-actions .btn {
            padding: 5px 10px;
            font-size: 12px;
        }

        .admin-form {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .admin-form h4 {
            margin-bottom: 15px;
            color: var(--admin);
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
                gap: 10px;
            }
            
            .user-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .user-actions {
                width: 100%;
                justify-content: flex-end;
            }
        }
    </style>
</head>
<body>
    <div id="customAlert" class="custom-alert-overlay">
        <div class="custom-alert-box">
            <h3 id="alertTitle"><span id="alertIcon" class="icon"></span> <span id="alertMessage"></span></h3>
            <p id="alertDescription"></p>
            <div class="alert-actions">
                <button class="btn btn-primary" id="alertConfirmBtn">OK</button>
                <button class="btn btn-outline" id="alertCancelBtn" style="display: none;">Cancel</button>
            </div>
        </div>
    </div>

    <div class="login-page" id="loginPage">
        <div class="login-box">
            <div class="login-logo">
                <img src="https://iili.io/FNJDqGt.png" alt="Ghost X Logo">
            </div>
            <form id="loginForm">
                <h2>User Login</h2>
                <div class="form-group">
                    <input type="text" id="loginUsername" class="form-control" placeholder="Username" required>
                </div>
                <div class="form-group">
                    <input type="password" id="loginPassword" class="form-control" placeholder="Password" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block">Login</button>
                <div class="login-footer">
                    Don't have an account? <a href="#" onclick="showRegisterForm()">Register</a>
                </div>
            </form>

            <form id="registerForm" style="display: none;">
                <h2>Create Account</h2>
                <div class="form-group">
                    <input type="text" id="regUsername" class="form-control" placeholder="Choose a Username" required>
                </div>
                <div class="form-group">
                    <input type="password" id="regPassword" class="form-control" placeholder="Choose a Password" required>
                </div>
                <button type="submit" class="btn btn-success btn-block">Register</button>
                <div class="login-footer">
                    Already have an account? <a href="#" onclick="showLoginForm()">Login</a>
                </div>
            </form>
        </div>
    </div>

    <div class="container" id="userPanel" style="display: none;">
        <div class="header">
            <div class="logo">
                <img src="https://iili.io/FNJDqGt.png" alt="Ghost X Logo">
                <h1>GHOST X MODS</h1>
            </div>
            <div class="user-menu">
                <img src="https://iili.io/FNJDqGt.png" alt="User" id="userAvatar">
                <span id="usernameDisplay">User</span>
                <button class="btn btn-outline" style="margin-left: 15px;" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
                <button class="btn btn-admin" style="margin-left: 15px; display: none;" id="adminToggleBtn" onclick="toggleAdminPanel()"><i class="fas fa-user-shield"></i> Admin Panel</button>
            </div>
        </div>

        <div class="admin-panel" id="adminPanel">
            <h2><i class="fas fa-user-shield"></i> Admin Dashboard</h2>
            
            <div class="admin-stats">
                <div class="admin-stat-card">
                    <h3>Total Users</h3>
                    <h2 id="totalUsers">0</h2>
                </div>
                <div class="admin-stat-card">
                    <h3>VIP Users</h3>
                    <h2 id="vipUsers">0</h2>
                </div>
                <div class="admin-stat-card">
                    <h3>Active Today</h3>
                    <h2 id="activeUsers">0</h2>
                </div>
                <div class="admin-stat-card">
                    <h3>Total Coins</h3>
                    <h2 id="totalCoins">0</h2>
                </div>
            </div>
            
            <div class="user-list" id="userListContainer">
                </div>
            
            <div class="admin-form">
                <h4><i class="fas fa-user-cog"></i> User Management</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label for="adminSearchUser">Search User</label>
                        <input type="text" id="adminSearchUser" class="form-control" placeholder="Enter username">
                    </div>
                    <div class="form-group">
                        <label for="adminAction">Action</label>
                        <select id="adminAction" class="form-control">
                            <option value="edit">Edit User</option>
                            <option value="addCoins">Add Coins</option>
                            <option value="removeCoins">Remove Coins</option>
                            <option value="addCredits">Add Credits</option>
                            <option value="removeCredits">Remove Credits</option>
                            <option value="makeVip">Make VIP</option>
                            <option value="removeVip">Remove VIP</option>
                            <option value="ban">Ban User</option>
                            <option value="unban">Unban User</option>
                        </select>
                    </div>
                </div>
                <div class="form-row" id="amountRow" style="display: none;">
                    <div class="form-group">
                        <label for="adminAmount">Amount</label>
                        <input type="number" id="adminAmount" class="form-control" placeholder="Enter amount">
                    </div>
                </div>
                <div class="form-row" id="vipDaysRow" style="display: none;">
                    <div class="form-group">
                        <label for="adminVipDays">VIP Days</label>
                        <input type="number" id="adminVipDays" class="form-control" placeholder="Enter days (0 for permanent)">
                    </div>
                </div>
                <button class="btn btn-admin btn-block" onclick="performAdminAction()"><i class="fas fa-check"></i> Execute Action</button>
                <div class="result-container" id="adminResult"></div>
            </div>
        </div>

        <div class="stats">
            <div class="stat-card"><h3>VIP Status</h3><h2 id="vipStatus">Free User</h2></div>
            <div class="stat-card"><h3>Ghost Coins</h3><h2 id="coinBalance">0</h2></div>
            <div class="stat-card"><h3>VIP Credits</h3><h2 id="creditBalance">0</h2></div>
        </div>

        <div class="services">
            <div class="service-tabs">
                <div class="service-tab active" onclick="showService('like')"><i class="fas fa-thumbs-up"></i> Like</div>
                <div class="service-tab" onclick="showService('visit')"><i class="fas fa-eye"></i> Visit</div>
                <div class="service-tab" onclick="showService('spam')"><i class="fas fa-bomb"></i> Spam</div>
                <div class="service-tab" onclick="showService('info')"><i class="fas fa-user-circle"></i> Player Info</div>
                <div class="service-tab" onclick="showService('bancheck')"><i class="fas fa-ban"></i> Ban Check</div>
                <div class="service-tab" onclick="showService('profile')"><i class="fas fa-id-card"></i> My Profile</div>
                <div class="service-tab" onclick="showService('buyCoins')"><i class="fas fa-coins"></i> Buy Coins</div>
            </div>

            <div class="service-content active" id="likeService">
                <form id="likeForm">
                    <h3>Like Service</h3>
                    <div class="form-group"><label>Select Region</label><div class="regions" id="likeRegions"></div></div>
                    <div class="form-group"><label for="likeUid">Free Fire UID</label><input type="text" id="likeUid" class="form-control" placeholder="Enter UID" required></div>
                    <button type="submit" class="btn btn-primary btn-block" id="likeBtn"><span id="likeBtnText">Send Likes</span><span id="likeBtnSpinner" class="spinner" style="display: none;"></span></button>
                    <div class="form-group" style="margin-top: 15px;"><small>Daily Limit: <span id="likeLimit">1</span> likes remaining</small></div>
                </form>
                <div class="result-container" id="likeResult"></div>
            </div>
            <div class="service-content" id="visitService">
                <form id="visitForm">
                    <h3>Visit Service</h3>
                    <div class="form-group"><label>Select Region</label><div class="regions" id="visitRegions"></div></div>
                    <div class="form-group"><label for="visitUid">Free Fire UID</label><input type="text" id="visitUid" class="form-control" placeholder="Enter UID" required></div>
                    <button type="submit" class="btn btn-primary btn-block" id="visitBtn"><span id="visitBtnText">Send Visits</span><span id="visitBtnSpinner" class="spinner" style="display: none;"></span></button>
                    <div class="form-group" style="margin-top: 15px;"><small>Cooldown: <span id="visitCooldown">Ready</span></small></div>
                </form>
                <div class="result-container" id="visitResult"></div>
            </div>
            <div class="service-content" id="spamService">
                <form id="spamForm">
                    <h3>Spam Service</h3>
                    <div class="form-group"><label>Select Region</label><div class="regions" id="spamRegions"></div></div>
                    <div class="form-group"><label for="spamUid">Free Fire UID</label><input type="text" id="spamUid" class="form-control" placeholder="Enter UID" required></div>
                    <button type="submit" class="btn btn-primary btn-block" id="spamBtn"><span id="spamBtnText">Start Spam</span><span id="spamBtnSpinner" class="spinner" style="display: none;"></span></button>
                    <div class="form-group" style="margin-top: 15px;"><small>Cooldown: <span id="spamCooldown">Ready</span></small></div>
                </form>
                <div class="result-container" id="spamResult"></div>
            </div>
            <div class="service-content" id="infoService">
                <form id="infoForm">
                    <h3>Player Info Finder</h3>
                    <div class="form-group"><label>Select Region</label><div class="regions" id="infoRegions"></div></div>
                    <div class="form-group"><label for="infoUid">Free Fire UID</label><input type="text" id="infoUid" class="form-control" placeholder="Enter UID" required></div>
                    <button type="submit" class="btn btn-primary btn-block" id="infoBtn"><span id="infoBtnText">Get Player Info</span><span id="infoBtnSpinner" class="spinner" style="display: none;"></span></button>
                </form>
                <div class="result-container" id="infoResult"></div>
                <div id="playerInfoDisplay" class="player-info" style="display: none;"></div>
                <div id="mediaDisplay" class="media-display"></div>
            </div>
            <div class="service-content" id="bancheckService">
                <form id="bancheckForm">
                    <h3>Ban Status Checker</h3>
                    <div class="form-group"><label for="bancheckUid">Free Fire UID</label><input type="text" id="bancheckUid" class="form-control" placeholder="Enter UID" required></div>
                    <button type="submit" class="btn btn-primary btn-block" id="bancheckBtn"><span id="bancheckBtnText">Check Ban Status</span><span id="bancheckBtnSpinner" style="display: none;"></span></button>
                </form>
                <div class="result-container" id="bancheckResult"></div>
            </div>
            <div class="service-content" id="profileService">
                <div class="profile-header">
                    <div class="profile-avatar-wrapper">
                        <img src="https://ui-avatars.com/api/?name=G&background=random" id="profileAvatarDisplay" alt="Profile Avatar">
                        <label for="avatarUpload" id="avatarUploadLabel" title="Change Avatar"><i class="fas fa-camera"></i></label>
                        <input type="file" id="avatarUpload" accept="image/*">
                    </div>
                    <h2 id="profileDisplayName"></h2>
                    <p id="profileVipStatus"></p>
                </div>

                <form id="profileUpdateForm">
                    <h3>Update Profile</h3>
                    <div class="form-group">
                        <label for="newDisplayName">Display Name</label>
                        <input type="text" id="newDisplayName" class="form-control" placeholder="Enter new display name">
                    </div>
                    <div class="form-group">
                        <label for="currentPassword">Current Password (for changes)</label>
                        <input type="password" id="currentPassword" class="form-control" placeholder="Enter current password">
                    </div>
                    <div class="form-group">
                        <label for="newPassword">New Password</label>
                        <input type="password" id="newPassword" class="form-control" placeholder="Enter new password (optional)">
                    </div>
                    <button type="submit" class="btn btn-primary btn-block" id="profileUpdateBtn"><span id="profileUpdateBtnText">Update Profile</span><span id="profileUpdateBtnSpinner" class="spinner" style="display: none;"></span></button>
                </form>
                <div class="result-container" id="profileResult"></div>
            </div>
            <div class="service-content" id="buyCoinsService">
                <h3>Buy Ghost Coins</h3>
                <p>Click on a package to purchase via Telegram.</p>
                <div class="coin-packages" id="coinPackagesContainer">
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-analytics-compat.js"></script>

    <script>
        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyAIU1ENiakzf0K31QD39viJackiDr0SamY",
            authDomain: "ghost-x-mods.firebaseapp.com",
            projectId: "ghost-x-mods",
            storageBucket: "ghost-x-mods.firebasestorage.app",
            messagingSenderId: "254419146699",
            appId: "1:254419146699:web:bababee42bb16601cf484e",
            measurementId: "G-12N5K4F5V7"
        };

        // Initialize Firebase
        const firebaseApp = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const analytics = firebase.analytics();

        // --- CONFIGURATION ---
        const API_ENDPOINTS = {
            LIKE: "https://vip-like-api-modx420.vercel.app/like",
            VISIT: "https://ghost-x-visit-api.vercel.app",
            PROFILE: "https://full-info-v2-gst-rho.vercel.app/player-info",
            BANNER: "https://ff-banner-image.vercel.app/banner-image",
            OUTFIT: "https://outfit-image-v2-ghost-x.vercel.app/outfit-image",
            SPAM: "https://spam-api-by-ghost.vercel.app/spam",
            BANCHECK: "https://ff-bancheck-info.vercel.app/bancheck"
        };
        
        const API_KEYS = { SPAM: "GST_MODX", OUTFIT: "GST_MODX" };
        const TELEGRAM_USERNAME = "JOBAYAR_AHMED";
        const DEFAULT_LOGO_URL = "https://iili.io/FNJDqGt.png";
        const VALID_REGIONS = { 'bd': 'BGD', 'ind': 'IND', 'pk': 'PAK', 'id': 'IDA', 'th': 'THA', 'my': 'MYS', 'vn': 'VNM', 'ru': 'RUS', 'mx': 'MEX', 'tw': 'TWN', 'me': 'MDE', 'eu': 'EUR', 'sg': 'SGP', 'ssa': 'SSA' };
        const ADMIN_PASSWORD = "x1x5"; // Admin password

        let currentUser = null;
        let isAdmin = false;
        let adminPanelVisible = false;

        // --- DOM ELEMENTS ---
        const loginPage = document.getElementById('loginPage');
        const userPanel = document.getElementById('userPanel');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const profileUpdateForm = document.getElementById('profileUpdateForm');
        const adminPanel = document.getElementById('adminPanel');
        const adminToggleBtn = document.getElementById('adminToggleBtn');

        // Custom alert DOM elements
        const customAlertOverlay = document.getElementById('customAlert');
        const customAlertBox = customAlertOverlay.querySelector('.custom-alert-box');
        const alertIcon = document.getElementById('alertIcon');
        const alertTitle = document.getElementById('alertTitle');
        const alertMessage = document.getElementById('alertMessage');
        const alertDescription = document.getElementById('alertDescription');
        const alertConfirmBtn = document.getElementById('alertConfirmBtn');
        const alertCancelBtn = document.getElementById('alertCancelBtn');

        // --- CUSTOM ALERT FUNCTION ---
        function showAlert(type, title, message, description = '', confirmText = 'OK', showCancel = false) {
            return new Promise((resolve) => {
                // Reset classes and content
                customAlertBox.className = 'custom-alert-box'; // Reset to base class
                customAlertBox.classList.add(type); // Add type class for styling

                alertIcon.innerHTML = '';
                if (type === 'success') {
                    alertIcon.classList = 'icon fas fa-check-circle';
                } else if (type === 'error') {
                    alertIcon.classList = 'icon fas fa-times-circle';
                } else if (type === 'info') {
                    alertIcon.classList = 'icon fas fa-info-circle';
                } else if (type === 'warning') {
                    alertIcon.classList = 'icon fas fa-exclamation-triangle';
                }
                
                alertTitle.innerHTML = `<span id="alertIcon" class="${alertIcon.classList.value}"></span> ${title}`;
                alertDescription.textContent = description;
                alertConfirmBtn.textContent = confirmText;

                if (showCancel) {
                    alertCancelBtn.style.display = 'inline-flex';
                } else {
                    alertCancelBtn.style.display = 'none';
                }

                alertConfirmBtn.onclick = () => {
                    customAlertOverlay.classList.remove('active');
                    resolve(true);
                };

                alertCancelBtn.onclick = () => {
                    customAlertOverlay.classList.remove('active');
                    resolve(false);
                };

                customAlertOverlay.classList.add('active');
            });
        }


        // --- CORE FUNCTIONS ---
        document.addEventListener('DOMContentLoaded', async () => {
            let deviceId = localStorage.getItem('ghostx_deviceId');
            if (!deviceId) {
                deviceId = generateUniqueId();
                localStorage.setItem('ghostx_deviceId', deviceId);
            }

            const loggedInUser = localStorage.getItem('ghostx_loggedInUser');
            if (loggedInUser) {
                // Attempt to fetch user data from Firebase first
                try {
                    const snapshot = await database.ref('users/' + loggedInUser).once('value');
                    const firebaseUserData = snapshot.val();

                    if (firebaseUserData && firebaseUserData.deviceId === deviceId) {
                        currentUser = { username: loggedInUser, ...firebaseUserData };
                        if (!currentUser.displayName) {
                            currentUser.displayName = currentUser.username;
                            syncUserDataToFirebase(); // Update Firebase with display name
                        }
                        
                        if (currentUser.isAdmin) { // Check isAdmin from firebase
                            isAdmin = true;
                            adminToggleBtn.style.display = 'inline-flex';
                        }
                        
                        showUserPanel();
                        logFirebaseEvent('login', { username: currentUser.username });
                    } else {
                        // Device ID mismatch or user not found in Firebase, force re-login
                        localStorage.removeItem('ghostx_loggedInUser');
                        await showAlert('warning', 'Security Alert!', 'This account was last logged in on a different device or your device ID changed. Please login again.');
                        showLoginPage();
                    }
                } catch (error) {
                    console.error("Firebase fetch error during auto-login:", error);
                    await showAlert('error', 'Login Error', 'Failed to connect to server. Please check your internet connection.');
                    showLoginPage();
                }
            } else {
                showLoginPage();
            }

            loginForm.addEventListener('submit', handleLogin);
            registerForm.addEventListener('submit', handleRegister);
            document.getElementById('avatarUpload').addEventListener('change', handleProfilePictureUpload);
            profileUpdateForm.addEventListener('submit', handleProfileUpdate);
            
            // Admin panel event listeners
            document.getElementById('adminAction').addEventListener('change', updateAdminFormFields);
            document.getElementById('adminSearchUser').addEventListener('input', () => loadAdminDashboard(true)); // Live search
        });

        // Firebase functions
        function logFirebaseEvent(eventName, eventData = {}) {
            if (!currentUser) return;
            
            // Add user info to event data
            eventData.username = currentUser.username;
            eventData.isAdmin = currentUser.isAdmin || false; // Use currentUser.isAdmin directly
            eventData.isVip = currentUser.vip || false;
            
            // Log to analytics
            analytics.logEvent(eventName, eventData);
            
            // Log to Realtime Database
            const timestamp = firebase.database.ServerValue.TIMESTAMP;
            const eventRef = database.ref('events').push();
            eventRef.set({
                event: eventName,
                data: eventData,
                timestamp: timestamp
            });
            
            // Update user stats in database only if it's a regular user or admin actions affect user data
            if (currentUser.username !== 'admin' || eventName === 'admin_action') {
                const userRef = database.ref('users/' + currentUser.username);
                userRef.update({
                    lastActive: timestamp,
                    deviceId: currentUser.deviceId,
                    displayName: currentUser.displayName || currentUser.username,
                    isVip: currentUser.vip || false,
                    coins: currentUser.coins || 0,
                    credits: currentUser.credits || 0,
                    banned: currentUser.banned || false,
                    lastUpdated: firebase.database.ServerValue.TIMESTAMP
                });
            }
        }

        async function syncUserDataToFirebase(usernameToSync = currentUser.username) {
            if (!usernameToSync) return; // Can't sync if no user is defined

            const usersDB = await fetchUsersFromFirebase(); // Get latest from Firebase
            const userToSave = usersDB[usernameToSync];

            if (!userToSave) {
                console.error("Attempted to sync a non-existent user to Firebase:", usernameToSync);
                return;
            }
            
            const userRef = database.ref('users/' + usernameToSync);
            await userRef.update({
                username: userToSave.username,
                displayName: userToSave.displayName || userToSave.username,
                coins: userToSave.coins || 0,
                credits: userToSave.credits || 0,
                vip: userToSave.vip || false,
                vipExpiry: userToSave.vipExpiry || null,
                lastCreditResetTimestamp: userToSave.lastCreditResetTimestamp || Date.now(),
                likeUsedToday: userToSave.likeUsedToday || 0,
                lastLikeReset: userToSave.lastLikeReset || new Date().toDateString(),
                lastVisit: userToSave.lastVisit || 0,
                lastSpam: userToSave.lastSpam || 0,
                avatar: userToSave.avatar || null,
                deviceId: userToSave.deviceId,
                banned: userToSave.banned || false,
                isAdmin: userToSave.isAdmin || false, // Ensure isAdmin status is saved
                password: userToSave.password, // Password needs to be saved but not directly exposed
                lastUpdated: firebase.database.ServerValue.TIMESTAMP
            });
        }


        function generateUniqueId() {
            // Using a more robust method for device ID
            let id = localStorage.getItem('ghostx_persistent_id');
            if (id) return id;

            // Generate a new ID if not found
            id = 'device-' + Math.random().toString(36).substr(2, 9) + '-' + Date.now();
            localStorage.setItem('ghostx_persistent_id', id);
            return id;
        }

        function showLoginPage() {
            loginPage.style.display = 'flex';
            userPanel.style.display = 'none';
        }

        function showUserPanel() {
            loginPage.style.display = 'none';
            userPanel.style.display = 'block';
            initializeUserPanel();
            
            if (isAdmin) {
                loadAdminDashboard();
            }
        }

        function initializeUserPanel() {
            if (!currentUser) return;
            updateUserStats();
            initRegions();
            setupServiceForms();
            populateCoinPackages();
            setInterval(updateCooldownDisplays, 1000);
            document.getElementById('newDisplayName').value = currentUser.displayName || currentUser.username;
        }

        function showLoginForm() {
            loginForm.style.display = 'block';
            registerForm.style.display = 'none';
        }

        async function showRegisterForm() {
            const deviceId = localStorage.getItem('ghostx_deviceId');
            const usersDB = await fetchUsersFromFirebase();
            const existingUserForDevice = Object.values(usersDB).find(user => user.deviceId === deviceId);

            if (existingUserForDevice) {
                await showAlert('error', 'Registration Failed', `An account is already registered on this device (${existingUserForDevice.username}). You cannot create another account.`);
                return;
            }

            loginForm.style.display = 'none';
            registerForm.style.display = 'block';
        }

        // --- USER & DATA MANAGEMENT ---
        async function fetchUsersFromFirebase() {
            try {
                const snapshot = await database.ref('users').once('value');
                return snapshot.val() || {};
            } catch (error) {
                console.error("Error fetching users from Firebase:", error);
                await showAlert('error', 'Data Error', 'Failed to load user data. Please check your internet connection.');
                return {};
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            const deviceId = localStorage.getItem('ghostx_deviceId');
            const usersDB = await fetchUsersFromFirebase();

            // Special admin login check
            if (username === 'admin' && password === ADMIN_PASSWORD) {
                if (!usersDB['admin']) {
                    usersDB['admin'] = {
                        password: ADMIN_PASSWORD,
                        coins: 999999,
                        credits: 999999,
                        vip: true,
                        vipExpiry: null,
                        lastCreditResetTimestamp: Date.now(),
                        likeUsedToday: 0,
                        lastLikeReset: new Date().toDateString(),
                        lastVisit: 0,
                        lastSpam: 0,
                        avatar: null,
                        displayName: 'Admin',
                        deviceId: deviceId, // Admin also gets a device ID for initial setup
                        isAdmin: true,
                        banned: false
                    };
                    await database.ref('users/admin').set(usersDB['admin']);
                }
                
                localStorage.setItem('ghostx_loggedInUser', 'admin');
                currentUser = { username: 'admin', ...usersDB['admin'] };
                isAdmin = true;
                adminToggleBtn.style.display = 'inline-flex';
                updateUserStats();
                showUserPanel();
                await showAlert('success', 'Admin Login Successful!', 'Welcome to the Admin Dashboard.');
                logFirebaseEvent('admin_login', { username: 'admin' });
                return;
            }

            if (usersDB[username] && usersDB[username].password === password) {
                if (usersDB[username].banned) {
                    await showAlert('error', 'Login Failed', 'Your account has been banned. Please contact support.');
                    logFirebaseEvent('login_failed_banned', { username: username });
                    return;
                }

                if (usersDB[username].deviceId && usersDB[username].deviceId !== deviceId) {
                    await showAlert('warning', 'Security Alert!', 'This account is registered on a different device. You cannot log in here.');
                    logFirebaseEvent('login_failed_device_mismatch', { username: username });
                    return;
                }

                if (!usersDB[username].deviceId) {
                    // This device ID assignment should only happen on first login to link the account
                    usersDB[username].deviceId = deviceId;
                    await database.ref('users/' + username).update({ deviceId: deviceId });
                }
                
                if (!usersDB[username].displayName) {
                    usersDB[username].displayName = username;
                    await database.ref('users/' + username).update({ displayName: username });
                }

                localStorage.setItem('ghostx_loggedInUser', username);
                currentUser = { username, ...usersDB[username] };
                updateUserStats();
                showUserPanel();
                await showAlert('success', 'Login Successful!', `Welcome back, ${currentUser.displayName}!`);
                logFirebaseEvent('login', { username: username });
            } else {
                await showAlert('error', 'Login Failed', 'Invalid username or password.');
                logFirebaseEvent('login_failed', { username: username });
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            const username = document.getElementById('regUsername').value.trim();
            const password = document.getElementById('regPassword').value.trim();
            const usersDB = await fetchUsersFromFirebase();
            const deviceId = localStorage.getItem('ghostx_deviceId');

            if (username.length < 3 || password.length < 6) {
                await showAlert('error', 'Registration Failed', 'Username must be at least 3 characters and Password at least 6 characters.');
                return;
            }
            
            if (!/^[a-zA-Z0-9_]+$/.test(username)) {
                await showAlert('error', 'Registration Failed', 'Username can only contain letters, numbers, and underscores.');
                return;
            }

            if (usersDB[username]) {
                await showAlert('error', 'Registration Failed', 'Username already exists. Please choose another one.');
                return;
            }

            const existingUserForDevice = Object.values(usersDB).find(user => user.deviceId === deviceId);
            if (existingUserForDevice) {
                await showAlert('error', 'Registration Failed', `An account is already registered on this device (${existingUserForDevice.username}). You cannot create another account.`);
                return;
            }
            
            const newUser = {
                password: password,
                coins: 10,
                credits: 1,
                vip: false,
                vipExpiry: null,
                lastCreditResetTimestamp: Date.now(),
                likeUsedToday: 0,
                lastLikeReset: new Date().toDateString(),
                lastVisit: 0,
                lastSpam: 0,
                avatar: null,
                displayName: username,
                deviceId: deviceId,
                banned: false,
                isAdmin: false,
                registeredAt: firebase.database.ServerValue.TIMESTAMP
            };

            try {
                await database.ref('users/' + username).set(newUser);
                await showAlert('success', 'Registration Successful!', 'Your account has been created. Please log in.');
                logFirebaseEvent('register', { username: username });
                showLoginForm();
            } catch (error) {
                console.error("Firebase registration error:", error);
                await showAlert('error', 'Registration Failed', 'An error occurred during registration. Please try again.');
            }
        }

        async function handleProfileUpdate(e) {
            e.preventDefault();
            const btn = document.getElementById('profileUpdateBtn');
            const resultDiv = document.getElementById('profileResult');
            toggleButtonState(btn, true, 'Updating...');

            const newDisplayName = document.getElementById('newDisplayName').value.trim();
            const currentPassword = document.getElementById('currentPassword').value.trim();
            const newPassword = document.getElementById('newPassword').value.trim();

            if (currentPassword === '') {
                showResult(resultDiv, 'error', 'Please enter your current password to update profile.');
                toggleButtonState(btn, false);
                return;
            }

            if (currentUser.password !== currentPassword) {
                showResult(resultDiv, 'error', 'Incorrect current password.');
                toggleButtonState(btn, false);
                return;
            }

            let changesMade = false;

            if (newDisplayName !== currentUser.displayName) {
                currentUser.displayName = newDisplayName;
                changesMade = true;
            }

            if (newPassword !== '') {
                if (newPassword.length < 6) {
                    showResult(resultDiv, 'error', 'New password must be at least 6 characters.');
                    toggleButtonState(btn, false);
                    return;
                }
                currentUser.password = newPassword;
                changesMade = true;
            }
            
            if (changesMade) {
                await syncUserDataToFirebase(); // Sync changes to Firebase
                updateUserStats();
                showResult(resultDiv, 'success', 'Profile updated successfully!');
                logFirebaseEvent('profile_update', { 
                    username: currentUser.username,
                    changed_display_name: newDisplayName !== currentUser.displayName,
                    changed_password: newPassword !== ''
                });
            } else {
                showResult(resultDiv, 'info', 'No changes detected.');
            }
            
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';

            toggleButtonState(btn, false);
        }

        async function logout() {
            const confirmed = await showAlert('info', 'Logout Confirmation', 'Are you sure you want to logout?', '', 'Yes', true);
            if (confirmed) {
                logFirebaseEvent('logout', { username: currentUser.username });
                currentUser = null;
                isAdmin = false;
                localStorage.removeItem('ghostx_loggedInUser');
                location.reload();
            }
        }

        async function handleProfilePictureUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = async (e) => {
                const avatarDataUrl = e.target.result;
                currentUser.avatar = avatarDataUrl;

                await syncUserDataToFirebase(); // Sync changes to Firebase
                updateUserStats();
                showResult(document.getElementById('profileResult'), 'success', 'Profile picture updated!');
                logFirebaseEvent('avatar_update', { username: currentUser.username });
            };
            reader.readAsDataURL(file);
        }

        // --- ADMIN PANEL FUNCTIONS ---
        async function toggleAdminPanel() {
            adminPanelVisible = !adminPanelVisible;
            if (adminPanelVisible) {
                adminPanel.classList.add('active');
                adminToggleBtn.innerHTML = '<i class="fas fa-times"></i> Close Panel';
                logFirebaseEvent('admin_panel_open', { username: currentUser.username });
                await loadAdminDashboard();
            } else {
                adminPanel.classList.remove('active');
                adminToggleBtn.innerHTML = '<i class="fas fa-user-shield"></i> Admin Panel';
            }
        }

        async function loadAdminDashboard(isSearch = false) {
            const usersDB = await fetchUsersFromFirebase();
            let userList = Object.values(usersDB);
            
            if (!isSearch) { // Only update stats on initial load, not on live search
                // Update stats
                document.getElementById('totalUsers').textContent = userList.length;
                document.getElementById('vipUsers').textContent = userList.filter(u => u.vip).length;
                document.getElementById('activeUsers').textContent = userList.filter(u => {
                    const lastActiveTimestamp = u.lastActive || u.registeredAt || 0;
                    return (Date.now() - lastActiveTimestamp) < (24 * 60 * 60 * 1000);
                }).length;
                document.getElementById('totalCoins').textContent = userList.reduce((sum, user) => sum + (user.coins || 0), 0);
            }

            // Filter users based on search input
            const searchUsername = document.getElementById('adminSearchUser').value.toLowerCase();
            if (searchUsername) {
                userList = userList.filter(user => 
                    (user.username && user.username.toLowerCase().includes(searchUsername)) ||
                    (user.displayName && user.displayName.toLowerCase().includes(searchUsername))
                );
            }
            
            // Populate user list
            const userListContainer = document.getElementById('userListContainer');
            userListContainer.innerHTML = '';
            
            userList.sort((a, b) => (a.username > b.username) ? 1 : -1).forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'user-item';
                userItem.innerHTML = `
                    <div class="user-info">
                        <img src="${user.avatar || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName || user.username).charAt(0)}&background=random&color=fff`}" class="user-avatar">
                        <div class="user-details">
                            <div class="user-name">${user.displayName || user.username} ${user.banned ? '<span style="color:var(--danger);">(BANNED)</span>' : ''}</div>
                            <div class="user-status">
                                ${user.vip ? '<span class="vip-badge">VIP</span>' : ''}
                                ${user.isAdmin ? '<span class="admin-badge">ADMIN</span>' : ''}
                                Coins: ${user.coins || 0} | Credits: ${user.credits || 0}
                            </div>
                        </div>
                    </div>
                    <div class="user-actions">
                        <button class="btn btn-primary" onclick="adminSelectUser('${user.username}')"><i class="fas fa-edit"></i> Select</button>
                    </div>
                `;
                userListContainer.appendChild(userItem);
            });
        }

        function updateAdminFormFields() {
            const action = document.getElementById('adminAction').value;
            document.getElementById('amountRow').style.display = ['addCoins', 'removeCoins', 'addCredits', 'removeCredits'].includes(action) ? 'flex' : 'none';
            document.getElementById('vipDaysRow').style.display = ['makeVip'].includes(action) ? 'flex' : 'none';
        }

        function adminSelectUser(username) {
            document.getElementById('adminSearchUser').value = username;
        }

        async function performAdminAction() {
            const username = document.getElementById('adminSearchUser').value.trim();
            const action = document.getElementById('adminAction').value;
            const amount = parseInt(document.getElementById('adminAmount').value) || 0;
            const vipDays = parseInt(document.getElementById('adminVipDays').value) || 0;
            const resultDiv = document.getElementById('adminResult');
            
            if (!username) {
                showResult(resultDiv, 'error', 'Please enter a username or select a user.');
                return;
            }
            
            const usersDB = await fetchUsersFromFirebase();
            let user = usersDB[username]; // Get a mutable copy
            
            if (!user) {
                showResult(resultDiv, 'error', 'User not found.');
                return;
            }
            
            if (user.isAdmin && username !== currentUser.username) {
                await showAlert('error', 'Action Restricted', 'Cannot modify another admin account.');
                showResult(resultDiv, 'error', 'Cannot modify another admin account.');
                return;
            }

            if (user.isAdmin && action === 'ban') {
                await showAlert('error', 'Action Restricted', 'Cannot ban an admin account.');
                showResult(resultDiv, 'error', 'Cannot ban an admin account.');
                return;
            }
            
            let message = '';
            
            switch(action) {
                case 'edit':
                    message = `Selected user: ${username}`;
                    break;
                    
                case 'addCoins':
                    user.coins = (user.coins || 0) + amount;
                    message = `Added ${amount} coins to ${username}. New balance: ${user.coins}`;
                    break;
                    
                case 'removeCoins':
                    user.coins = Math.max(0, (user.coins || 0) - amount);
                    message = `Removed ${amount} coins from ${username}. New balance: ${user.coins}`;
                    break;
                    
                case 'addCredits':
                    user.credits = (user.credits || 0) + amount;
                    message = `Added ${amount} credits to ${username}. New balance: ${user.credits}`;
                    break;
                    
                case 'removeCredits':
                    user.credits = Math.max(0, (user.credits || 0) - amount);
                    message = `Removed ${amount} credits from ${username}. New balance: ${user.credits}`;
                    break;
                    
                case 'makeVip':
                    user.vip = true;
                    if (vipDays > 0) {
                        const expiryDate = new Date();
                        expiryDate.setDate(expiryDate.getDate() + vipDays);
                        user.vipExpiry = expiryDate.getTime();
                        message = `Made ${username} VIP for ${vipDays} days. Expires on ${expiryDate.toLocaleDateString()}.`;
                    } else {
                        user.vipExpiry = null; // Permanent VIP
                        message = `Made ${username} a permanent VIP.`;
                    }
                    break;
                    
                case 'removeVip':
                    user.vip = false;
                    user.vipExpiry = null;
                    message = `Removed VIP status from ${username}.`;
                    break;
                    
                case 'ban':
                    user.banned = true;
                    message = `Banned user ${username}.`;
                    break;
                    
                case 'unban':
                    user.banned = false;
                    message = `Unbanned user ${username}.`;
                    break;
                    
                default:
                    message = 'Invalid action selected.';
            }
            
            // Save changes to Firebase
            try {
                await database.ref('users/' + username).update(user);
                showResult(resultDiv, 'success', message);
                await showAlert('success', 'Action Successful!', message);

                // If modifying current user, update local currentUser
                if (currentUser.username === username) {
                    currentUser = { ...currentUser, ...user };
                    updateUserStats();
                }
                
                logFirebaseEvent('admin_action', {
                    action: action,
                    admin_username: currentUser.username,
                    target_user: username,
                    amount: amount,
                    vip_days: vipDays
                });

                loadAdminDashboard(); // Refresh the user list and stats
            } catch (error) {
                console.error("Firebase admin action error:", error);
                showResult(resultDiv, 'error', `Failed to perform action: ${error.message}`);
                await showAlert('error', 'Action Failed!', `Failed to perform action: ${error.message}`);
            }
        }

        // --- UI & SERVICE FUNCTIONS ---
        function showService(serviceName) {
            document.querySelectorAll('.service-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.service-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`.service-tab[onclick="showService('${serviceName}')"]`).classList.add('active');
            document.getElementById(serviceName + 'Service').classList.add('active');
            document.querySelectorAll('.result-container').forEach(rc => rc.style.display = 'none');
            document.getElementById('playerInfoDisplay').style.display = 'none';
            document.getElementById('mediaDisplay').innerHTML = '';
            
            // Hide admin panel when switching services
            if (adminPanelVisible) {
                toggleAdminPanel();
            }
            
            // Log service view to Firebase
            if (currentUser) {
                logFirebaseEvent('service_view', {
                    service: serviceName,
                    username: currentUser.username
                });
            }
        }

        async function updateUserStats() {
            if (!currentUser) return;

            const now = Date.now();
            const twentyFourHours = 24 * 60 * 60 * 1000;
            const todayDateString = new Date().toDateString();

            // Fetch the latest user data from Firebase to avoid stale data issues
            try {
                const snapshot = await database.ref('users/' + currentUser.username).once('value');
                const latestUserData = snapshot.val();
                if (latestUserData) {
                    currentUser = { ...currentUser, ...latestUserData }; // Update local currentUser
                }
            } catch (error) {
                console.error("Error fetching latest user data for stats update:", error);
                // Continue with local data if Firebase fetch fails, but log error
            }

            // Daily credit reset for non-VIP
            if (!currentUser.vip) {
                if (!currentUser.lastCreditResetTimestamp) {
                    currentUser.lastCreditResetTimestamp = now;
                    currentUser.credits = 1;
                } else if (now - currentUser.lastCreditResetTimestamp >= twentyFourHours) {
                    currentUser.credits = 1;
                    currentUser.lastCreditResetTimestamp = now;
                }
            } else { // VIP user's credit reset based on expiry or permanent VIP
                if (currentUser.vipExpiry && now > currentUser.vipExpiry) {
                    currentUser.vip = false;
                    currentUser.vipExpiry = null;
                    currentUser.credits = 1; // Reset to free user credit
                    await showAlert('info', 'VIP Expired!', 'Your VIP status has expired. Please purchase a new VIP package.');
                }
            }

            // Daily like usage reset for all users
            if (currentUser.lastLikeReset !== todayDateString) {
                currentUser.likeUsedToday = 0;
                currentUser.lastLikeReset = todayDateString;
            }

            const avatarUrl = currentUser.avatar || `https://ui-avatars.com/api/?name=${encodeURIComponent(currentUser.displayName || currentUser.username).charAt(0)}&background=random&color=fff`;
            document.getElementById('userAvatar').src = avatarUrl;
            document.getElementById('profileAvatarDisplay').src = avatarUrl;

            document.getElementById('usernameDisplay').textContent = currentUser.displayName || currentUser.username;
            document.getElementById('profileDisplayName').textContent = currentUser.displayName || currentUser.username;

            const isVip = currentUser.vip;
            let vipHtml = 'Free User';
            if (isVip) {
                if (currentUser.vipExpiry) {
                    const daysRemaining = Math.ceil((currentUser.vipExpiry - now) / (24 * 60 * 60 * 1000));
                    vipHtml = `VIP Member <span class="vip-badge">${daysRemaining} Days Left</span>`;
                } else {
                    vipHtml = 'VIP Member <span class="vip-badge">Permanent</span>';
                }
            }
            document.getElementById('vipStatus').innerHTML = vipHtml;
            document.getElementById('profileVipStatus').innerHTML = vipHtml;


            document.getElementById('coinBalance').textContent = currentUser.coins;
            document.getElementById('creditBalance').textContent = currentUser.credits;

            const likeLimit = isVip ? 5 : 1;
            document.getElementById('likeLimit').textContent = `${Math.max(0, likeLimit - currentUser.likeUsedToday)} likes remaining`;

            await syncUserDataToFirebase();
        }

        function initRegions() {
            const regionContainers = document.querySelectorAll('.regions');
            regionContainers.forEach(container => {
                container.innerHTML = '';
                Object.entries(VALID_REGIONS).forEach(([code, name]) => {
                    const btn = document.createElement('div');
                    btn.className = 'region-btn';
                    btn.textContent = name;
                    btn.dataset.region = code;
                    btn.onclick = () => {
                        container.querySelectorAll('.region-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                    };
                    container.appendChild(btn);
                });
                if (container.firstChild) container.firstChild.classList.add('active');
            });
        }

        function populateCoinPackages() {
            const container = document.getElementById('coinPackagesContainer');
            const packages = [
                { coins: 100, price: '1.00 USD' },
                { coins: 550, price: '5.00 USD' },
                { coins: 1200, price: '10.00 USD' }
            ];
            container.innerHTML = packages.map(p => `
                <div class="coin-package">
                    <i class="fas fa-coins"></i>
                    <h4>${p.coins} Coins</h4>
                    <p class="coin-price">${p.price}</p>
                    <button class="btn btn-success" onclick="buyCoins(${p.coins})">Buy Now</button>
                </div>
            `).join('');
        }

        async function buyCoins(amount) {
            const confirmed = await showAlert('info', 'Purchase Confirmation', `You are about to purchase ${amount} Ghost Coins. You will be redirected to Telegram to complete the purchase.`, '', 'Continue', true);
            if (confirmed) {
                const message = `Hello, I would like to buy ${amount} Ghost Coins. My username is: ${currentUser.username}`;
                const telegramUrl = `https://t.me/${TELEGRAM_USERNAME}?text=${encodeURIComponent(message)}`;
                window.open(telegramUrl, '_blank');
                logFirebaseEvent('coin_purchase_attempt', {
                    username: currentUser.username,
                    amount: amount
                });
            }
        }

        function updateCooldownDisplays() {
            if (!currentUser) return;
            const now = Date.now();
            const visitRemaining = Math.max(0, 120000 - (now - currentUser.lastVisit));
            document.getElementById('visitCooldown').textContent = visitRemaining > 0 ? `${Math.ceil(visitRemaining / 1000)}s` : 'Ready';
            const spamRemaining = Math.max(0, 60000 - (now - currentUser.lastSpam));
            document.getElementById('spamCooldown').textContent = spamRemaining > 0 ? `${Math.ceil(spamRemaining / 1000)}s` : 'Ready';
        }

        async function fetchApi(url, isBinary = false) {
            const proxiedUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
            try {
                const response = await fetch(proxiedUrl);
                if (!response.ok) {
                    const errorBody = await response.text();
                    let errorMessage = `HTTP error! Status: ${response.status}. `;
                    try {
                        const jsonError = JSON.parse(errorBody);
                        errorMessage += jsonError.message || jsonError.error || JSON.stringify(jsonError);
                    } catch (e) {
                        errorMessage += `Response was not JSON. Content: ${errorBody.substring(0, 200)}${errorBody.length > 200 ? '...' : ''}`;
                    }
                    throw new Error(errorMessage);
                }
                if (isBinary) {
                    return await response.blob();
                }
                const contentType = response.headers.get("content-type");
                if (contentType && contentType.includes("application/json")) {
                    return await response.json();
                } else {
                    const textResponse = await response.text();
                    try {
                        return JSON.parse(textResponse);
                    } catch (e) {
                        console.warn(`Expected JSON but received non-JSON for ${url}. Content:`, textResponse.substring(0, 200));
                        return { error: `API returned non-JSON response. Please check API URL or content. Raw: ${textResponse.substring(0, 100)}...` };
                    }
                }
            } catch (error) {
                console.error("API Fetch Error:", error);
                return { error: `API Connection/Parse Error: ${error.message}. Please check your internet connection or API server status.` };
            }
        }

        // --- SERVICE FORM HANDLERS ---
        function setupServiceForms() {
            // Like Form
            setupForm('likeForm', async (data) => {
                if (currentUser.banned) {
                    await showAlert('error', 'Account Banned!', 'Your account has been banned. Contact support for more information.');
                    return { error: 'Your account has been banned. Contact support for more information.' };
                }
                
                const likeLimit = currentUser.vip ? 5 : 1;
                if ((likeLimit - currentUser.likeUsedToday) <= 0) {
                    await showAlert('info', 'Daily Limit Reached!', 'You have reached your daily like limit. Please wait until the next reset.');
                    return { error: 'You have reached your daily like limit. Please wait until the next reset.' };
                }
                if (!currentUser.vip && currentUser.credits <= 0) {
                    await showAlert('warning', 'No VIP Credits!', 'Not enough VIP Credits. Complete tasks or buy coins.');
                    return { error: 'Not enough VIP Credits. Complete tasks or buy coins.' };
                }

                const result = await fetchApi(`${API_ENDPOINTS.LIKE}?server_name=${data.region}&uid=${data.uid}`);
                if (result.status === 1) {
                    if (!currentUser.vip) {
                        currentUser.credits--;
                    }
                    currentUser.likeUsedToday++;
                    
                    // Log like action to Firebase
                    logFirebaseEvent('like_sent', {
                        username: currentUser.username,
                        target_uid: data.uid,
                        region: data.region,
                        result: result
                    });
                    
                    return { success: `<h4> LIKE SUCCESSFULLY DELIVERED!</h4>
                        <div class="result-details">
                            <p><strong>Player:</strong> ${result.PlayerNickname || 'N/A'}</p>
                            <p><strong>Before:</strong> ${result.LikesbeforeCommand || 'N/A'} -> <strong>After:</strong> ${result.LikesafterCommand || 'N/A'}</p>
                        </div>`};
                }
                if (result.status === 2) {
                     return { info: 'Request failed. (Status 2: Possibly already liked or invalid UID/Region). Please verify UID/Region.' };
                }
                return { error: result.error || 'Request failed. Please check console for API error.' };
            });

            // Visit Form
            setupForm('visitForm', async (data) => {
                if (currentUser.banned) {
                    await showAlert('error', 'Account Banned!', 'Your account has been banned. Contact support for more information.');
                    return { error: 'Your account has been banned. Contact support for more information.' };
                }
                
                if (!currentUser.vip && (Date.now() - currentUser.lastVisit) < 120000) {
                    await showAlert('info', 'Cooldown Active!', 'Cooldown active. Please wait 2 minutes before sending another visit.');
                    return { error: 'Cooldown active. Please wait 2 minutes.' };
                }
                if (!currentUser.vip && currentUser.credits <= 0) {
                    await showAlert('warning', 'No VIP Credits!', 'Not enough VIP Credits. Complete tasks or buy coins.');
                    return { error: 'Not enough VIP Credits. Complete tasks or buy coins.' };
                }

                const result = await fetchApi(`${API_ENDPOINTS.VISIT}/${data.region}/${data.uid}`);
                if (result.nickname) {
                    if (!currentUser.vip) {
                        currentUser.credits--;
                        currentUser.lastVisit = Date.now();
                    }
                    
                    // Log visit action to Firebase
                    logFirebaseEvent('visit_sent', {
                        username: currentUser.username,
                        target_uid: data.uid,
                        region: data.region,
                        result: result
                    });
                    
                    return { success: `<h4> VISIT SUCCESSFULLY DELIVERED!</h4>
                        <div class="result-details"><p>Player: ${result.nickname}</p><p>Level: ${result.level}</p></div>` };
                }
                return { error: result.error || 'Request failed. Please check console for API error.' };
            });

            // Spam Form
            setupForm('spamForm', async (data) => {
                if (currentUser.banned) {
                    await showAlert('error', 'Account Banned!', 'Your account has been banned. Contact support for more information.');
                    return { error: 'Your account has been banned. Contact support for more information.' };
                }
                
                if (data.region !== 'bd') {
                    await showAlert('info', 'Region Restricted!', 'Spam service is currently only available for the Bangladesh (BD) region.');
                    return { error: 'Spam service is only for BD region.' };
                }
                if (!currentUser.vip && (Date.now() - currentUser.lastSpam) < 60000) {
                    await showAlert('info', 'Cooldown Active!', 'Cooldown active. Please wait 1 minute before sending more spam.');
                    return { error: 'Cooldown active. Please wait 1 minute.' };
                }
                if (!currentUser.vip && currentUser.credits <= 0) {
                    await showAlert('warning', 'No VIP Credits!', 'Not enough VIP Credits. Complete tasks or buy coins.');
                    return { error: 'Not enough VIP Credits. Complete tasks or buy coins.' };
                }

                const result = await fetchApi(`${API_ENDPOINTS.SPAM}?uid=${data.uid}&key=${API_KEYS.SPAM}`);
                if (result.status === 1) {
                    if (!currentUser.vip) {
                        currentUser.credits--;
                        currentUser.lastSpam = Date.now();
                    }
                    
                    // Log spam action to Firebase
                    logFirebaseEvent('spam_sent', {
                        username: currentUser.username,
                        target_uid: data.uid,
                        region: data.region,
                        result: result
                    });
                    
                    return { success: '<h4> SPAM INITIATED!</h4><p>Spam request sent successfully. This service might take some time to reflect.</p>' };
                }
                return { error: result.error || 'Spam request failed. Please check console for API error.' };
            });

            // Ban Check Form
            setupForm('bancheckForm', async (data) => {
                const result = await fetchApi(`${API_ENDPOINTS.BANCHECK}?uid=${data.uid}`);
                if (result.ban_status) {
                    const isBanned = result.ban_status !== "Not Banned";
                    
                    // Log ban check to Firebase
                    logFirebaseEvent('ban_check', {
                        username: currentUser.username,
                        target_uid: data.uid,
                        is_banned: isBanned
                    });
                    
                    const html = `<h4>${isBanned ? '' : ''} BAN CHECK RESULT</h4>
                        <div class="result-details">
                            <p><strong>Status:</strong> ${result.ban_status}</p>
                            ${isBanned ? `<p><strong>Since:</strong> ${result.banned_since || 'N/A'}</p>` : ''}
                            <p><strong>Nickname:</strong> ${result.nickname || 'N/A'}</p>
                        </div>`;
                    return { [isBanned ? 'error' : 'success']: html };
                }
                return { error: result.error || 'Ban check failed. Please check console for API error.' };
            }, false);

            // Player Info Form
            document.getElementById('infoForm').addEventListener('submit', async function (e) {
                e.preventDefault();
                const btn = document.getElementById('infoBtn');
                const resultDiv = document.getElementById('infoResult');
                const playerInfoDisplay = document.getElementById('playerInfoDisplay');
                const mediaDisplay = document.getElementById('mediaDisplay');

                const uid = document.getElementById('infoUid').value.trim();
                if (!/^\d{8,12}$/.test(uid)) {
                    showResult(resultDiv, 'error', ' Please enter a valid UID (8-12 digits).');
                    toggleButtonState(btn, false);
                    return;
                }

                toggleButtonState(btn, true);
                resultDiv.style.display = 'none';
                playerInfoDisplay.style.display = 'none';
                mediaDisplay.innerHTML = '';

                const activeRegionBtn = this.querySelector('.regions .active');
                if (!activeRegionBtn) {
                    showResult(resultDiv, 'error', ' Please select a region.');
                    toggleButtonState(btn, false);
                    return;
                }
                const region = activeRegionBtn.dataset.region;

                const profileData = await fetchApi(`${API_ENDPOINTS.PROFILE}?uid=${uid}&region=${region}`);

                if (profileData && profileData.basicInfo) {
                    const basic = profileData.basicInfo || {};
                    const clan = profileData.clanBasicInfo || {};
                    const pet = profileData.petInfo || {};
                    const social = profileData.socialInfo || {};

                    playerInfoDisplay.innerHTML = `
                        <div class="info-section">
                           <h4><i class="fas fa-user"></i> PLAYER: ${basic.nickname || 'N/A'}</h4>
                           <p><strong>Level:</strong> ${basic.level || 'N/A'} | <strong>Likes:</strong> ${basic.liked?.toLocaleString() || '0'}</p>
                           <p><strong>Created:</strong> ${basic.createAt ? new Date(parseInt(basic.createAt) * 1000).toLocaleDateString() : 'N/A'}</p>
                           <p><strong>Last Login:</strong> ${basic.lastLoginAt ? new Date(parseInt(basic.lastLoginAt) * 1000).toLocaleString() : 'N/A'}</p>
                           <p><strong>Region:</strong> ${basic.region || 'N/A'}</p>
                           <p><strong>BR Rank:</strong> ${basic.rank || 'N/A'} | <strong>CS Rank:</strong> ${basic.csRank || 'N/A'}</p>
                        </div>
                        ${clan.clanName ? `
                        <div class="info-section">
                           <h4><i class="fas fa-users"></i> CLAN INFO</h4>
                           <p><strong>Name:</strong> ${clan.clanName}</p>
                           <p><strong>Level:</strong> ${clan.clanLevel || 'N/A'}</p>
                           <p><strong>Members:</strong> ${clan.memberNum || 'N/A'} / ${clan.capacity || 'N/A'}</p>
                           <p><strong>Captain:</strong> ${clan.captainBasicInfo?.nickname || 'N/A'}</p>
                        </div>` : ''}
                        ${pet.id ? `
                        <div class="info-section">
                           <h4><i class="fas fa-paw"></i> PET INFO</h4>
                           <p><strong>Pet ID:</strong> ${pet.id || 'N/A'}</p>
                           <p><strong>Level:</strong> ${pet.level || 'N/A'}</p>
                           <p><strong>Skin ID:</strong> ${pet.skinId || 'N/A'}</p>
                        </div>` : ''}
                        ${social.signature ? `
                        <div class="info-section">
                           <h4><i class="fas fa-quote-right"></i> SOCIAL INFO</h4>
                           <p><strong>Signature:</strong> ${social.signature.replace(/.*?/g, '') || 'N/A'}</p>
                           <p><strong>Gender:</strong> ${social.gender?.replace('Gender_', '') || 'N/A'}</p>
                           <p><strong>Language:</strong> ${social.language?.replace('Language_', '') || 'N/A'}</p>
                        </div>` : ''}
                    `;
                    playerInfoDisplay.style.display = 'grid';

                    // Fetch and display banner/outfit images
                    const bannerBlob = await fetchApi(`${API_ENDPOINTS.BANNER}?uid=${uid}&region=${region}`, true);
                    if (bannerBlob instanceof Blob) {
                        mediaDisplay.innerHTML += `<div class="media-item"><h4>Banner</h4><img src="${URL.createObjectURL(bannerBlob)}"></div>`;
                    } else {
                        console.warn("Could not load banner image. Check API or CORS. Error:", bannerBlob.error);
                    }

                    const outfitBlob = await fetchApi(`${API_ENDPOINTS.OUTFIT}?uid=${uid}&region=${region}&key=${API_KEYS.OUTFIT}`, true);
                    if (outfitBlob instanceof Blob) {
                        mediaDisplay.innerHTML += `<div class="media-item"><h4>Outfit</h4><img src="${URL.createObjectURL(outfitBlob)}"></div>`;
                    } else {
                        console.warn("Could not load outfit image. Check API or CORS. Error:", outfitBlob.error);
                    }
                    showResult(resultDiv, 'success', `<h4> PLAYER INFO RETRIEVED!</h4><p>Details displayed below.</p>`);
                    
                    // Log player info lookup to Firebase
                    logFirebaseEvent('player_info_lookup', {
                        username: currentUser.username,
                        target_uid: uid,
                        region: region,
                        player_name: basic.nickname || 'N/A'
                    });

                } else {
                    showResult(resultDiv, 'error', `<h4> PLAYER NOT FOUND!</h4><p>${profileData.error || 'Could not retrieve information. Please check UID and Region. Also check console for API error.'}</p>`);
                }
                toggleButtonState(btn, false);
            });
        }

        function setupForm(formId, apiCall, hasRegion = true) {
            const form = document.getElementById(formId);
            const resultDiv = document.getElementById(formId.replace('Form', 'Result'));
            const btn = form.querySelector('button[type="submit"]');

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                const uidInput = form.querySelector('input[type="text"]');
                const uid = uidInput.value.trim();

                showResult(resultDiv, 'none');

                if (!/^\d{8,12}$/.test(uid)) {
                    showResult(resultDiv, 'error', ' Please enter a valid UID (8-12 digits).');
                    toggleButtonState(btn, false);
                    return;
                }

                toggleButtonState(btn, true);

                const data = { uid };
                if (hasRegion) {
                    const activeRegionBtn = form.querySelector('.regions .active');
                    if (!activeRegionBtn) {
                        showResult(resultDiv, 'error', ' Please select a region.');
                        toggleButtonState(btn, false);
                        return;
                    }
                    data.region = activeRegionBtn.dataset.region;
                }

                const result = await apiCall(data);

                if (result.success) {
                    showResult(resultDiv, 'success', result.success);
                    await showAlert('success', 'Success!', 'Your request was processed successfully.');
                } else if (result.info) {
                    showResult(resultDiv, 'info', `<h4> INFO</h4><p>${result.info}</p>`);
                    await showAlert('info', 'Information', result.info);
                } else {
                    showResult(resultDiv, 'error', `<h4> FAILED!</h4><p>${result.error}</p>`);
                    await showAlert('error', 'Failed!', result.error);
                }

                await syncUserDataToFirebase();
                updateUserStats();

                toggleButtonState(btn, false);
            });
        }

        function showResult(resultDiv, type, message) {
            resultDiv.style.display = 'none';
            resultDiv.className = 'result-container';
            if (type !== 'none') {
                resultDiv.classList.add(type);
                resultDiv.innerHTML = message;
                resultDiv.style.display = 'block';
            }
        }

        function toggleButtonState(btn, isLoading, loadingText = 'Processing...') {
            const textSpan = btn.querySelector('span:not(.spinner)');
            const spinnerSpan = btn.querySelector('.spinner');
            if (isLoading) {
                if (!btn.dataset.originalText) btn.dataset.originalText = textSpan.textContent;
                textSpan.textContent = loadingText;
                spinnerSpan.style.display = 'inline-block';
                btn.disabled = true;
            } else {
                textSpan.textContent = btn.dataset.originalText;
                spinnerSpan.style.display = 'none';
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
